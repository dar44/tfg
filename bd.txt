create extension if not exists "pgcrypto";

create table users (
    id uuid primary key default gen_random_uuid(),
    name text not null,
    surname text not null,
    dni text not null unique,
    email text not null unique,
    email_verified_at timestamptz,
    password text not null,
    phone text,
    role text not null default 'user',
    image text,
    remember_token text,
    created_at timestamptz not null default now(),
    updated_at timestamptz not null default now()
);

create table cursos (
    id uuid primary key default gen_random_uuid(),
    name text not null,
    description text,
    location text,
    beginning_date date,
    end_date date,
    price numeric(10,2),
    state text,
    capacity integer,
    image text,
    created_at timestamptz not null default now(),
    updated_at timestamptz not null default now()
);

create table recintos (
    id uuid primary key default gen_random_uuid(),
    name text not null,
    description text,
    ubication text,
    province text,
    postal_code text,
    image text,
    state text,
    created_at timestamptz not null default now(),
    updated_at timestamptz not null default now()
);

create table inscripciones (
    id uuid primary key default gen_random_uuid(),
    user_id uuid not null references users(id) on delete cascade,
    curso_id uuid not null references cursos(id) on delete cascade,
    status text,
    paid boolean not null default false,
    cancelled_by uuid references users(id),
    created_at timestamptz not null default now(),
    updated_at timestamptz not null default now()
);

create table reservas (
    id uuid primary key default gen_random_uuid(),
    user_id uuid not null references users(id) on delete cascade,
    recinto_id uuid not null references recintos(id) on delete cascade,
    start_at timestamptz not null,
    end_at timestamptz not null,
    price numeric(10,2),
    status text,
    paid boolean not null default false,
    observations text,
    created_at timestamptz not null default now(),
    updated_at timestamptz not null default now()
);

create index on inscripciones (user_id);
create index on inscripciones (curso_id);
create index on reservas (user_id);
create index on reservas (recinto_id);